var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof2(e)};!function(){"use strict";var n,e,o,c=window.crypto||window.msCrypto,i=window.localStorage,l="hexo-blog-encrypt:#"+window.location.pathname,a=p("hexo-blog-encrypt的作者们都是大帅比!"),y=p("hexo-blog-encrypt是地表最强Hexo加密插件!"),t=document.getElementById("hexo-blog-encrypt"),u=t.dataset.wpm,d=t.dataset.whm,r=t.getElementsByTagName("script").hbeData,f=r.innerText,m=r.dataset.hmacdigest;function s(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(e){return parseInt(e,16)}))}function p(e){for(var t=e.length,n=0,o=new Array,r=0;r<t;){var i=e.codePointAt(r);i<128?(o[n++]=i,r++):127<i&&i<2048?(o[n++]=i>>6|192,o[n++]=63&i|128,r++):2047<i&&i<65536?(o[n++]=i>>12|224,o[n++]=i>>6&63|128,o[n++]=63&i|128,r++):(o[n++]=i>>18|240,o[n++]=i>>12&63|128,o[n++]=i>>6&63|128,o[n++]=63&i|128,r+=2)}return new Uint8Array(o)}async function h(e,t,a){var n=s(f);return c.subtle.decrypt({name:"AES-CBC",iv:t},e,n.buffer).then(async function(e){if(!(e=(new TextDecoder).decode(e)).startsWith("<hbe-prefix></hbe-prefix>"))throw"Decode successfully but not start with KnownPrefix.";var t=document.createElement("button");t.textContent="Encrypt again",t.type="button",t.classList.add("hbe-button"),t.addEventListener("click",function(){window.localStorage.removeItem(l),window.location.reload()}),document.getElementById("hexo-blog-encrypt").style.display="inline",document.getElementById("hexo-blog-encrypt").innerHTML="",document.getElementById("hexo-blog-encrypt").appendChild((n=e,(o=document.createElement("div")).innerHTML=n,o.querySelectorAll("script").forEach(async function(e){var t,n;e.replaceWith((t=e,n=document.createElement("script"),["type","text","src","crossorigin","defer","referrerpolicy"].forEach(function(e){t[e]&&(n[e]=t[e])}),await n))}),await o)),document.getElementById("hexo-blog-encrypt").appendChild(t),document.querySelectorAll("img").forEach(function(e){e.getAttribute("data-src")&&!e.src&&(e.src=e.getAttribute("data-src"))}),window.NexT&&NexT.boot&&"function"==typeof NexT.boot.refresh&&NexT.boot.refresh();(t=document.getElementById("toc-div"))&&(t.style.display="inline");var n,o,r=document.getElementsByClassName("toc-div-class");if(r&&0<r.length)for(var i=0;i<r.length;i++)r[i].style.display="inline";return t=a,e=(new TextEncoder).encode(e),n=s(m),t=await c.subtle.verify({name:"HMAC",hash:"SHA-256"},t,n,e),console.log("Verification result: "+t),t||(alert(d),console.log(d+", got ",n," but proved wrong.")),t}).catch(function(e){return alert(u),console.log(e),!1})}(r=JSON.parse(i.getItem(l)))&&(console.log("Password got from localStorage("+l+"): ",r),n=s(r.iv).buffer,e=r.dk,o=r.hmk,c.subtle.importKey("jwk",e,{name:"AES-CBC",length:256},!0,["decrypt"]).then(function(t){c.subtle.importKey("jwk",o,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]).then(function(e){h(t,n,e).then(function(e){e||i.removeItem(l)})})})),t.addEventListener("keydown",async function(e){var n,t,o,r;!e.isComposing&&13!==e.keyCode||(e=document.getElementById("hbePass").value,r=new TextEncoder,r=await c.subtle.importKey("raw",r.encode(e),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),n=await c.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:a.buffer,iterations:1024},r,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]),t=await c.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:a.buffer,iterations:1024},r,{name:"AES-CBC",length:256},!0,["decrypt"]),o=await c.subtle.deriveBits({name:"PBKDF2",hash:"SHA-256",salt:y.buffer,iterations:512},r,128),h(t,o,n).then(function(e){console.log("Decrypt result: "+e),e&&c.subtle.exportKey("jwk",t).then(function(t){c.subtle.exportKey("jwk",n).then(function(e){e={dk:t,iv:function(e){if("object"!==(void 0===e?"undefined":_typeof(e))||null===e||"number"!=typeof e.byteLength)throw new TypeError("Expected input to be an ArrayBuffer");for(var t,n=new Uint8Array(e),o="",r=0;r<n.length;r++)o+=1===(t=n[r].toString(16)).length?"0"+t:t;return o}(o),hmk:e},i.setItem(l,JSON.stringify(e))})})}))})}();